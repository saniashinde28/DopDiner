<!-- Heading aligned with panel -->
<h2 class="max-w-4xl mx-auto text-3xl font-bold text-gray-800 mb-2 text-left">
  Dopamine Menu
</h2>
<p class="max-w-4xl mx-auto text-xl font-medium text-gray-400 mb-4 text-left">
  Choose your pick
</p>

<!-- Category Panel -->
<div class="bg-white/30 backdrop-blur-sm py-1.5 shadow-md max-w-4xl mx-auto rounded-lg">
  <nav class="flex justify-between px-6">
    
    <!-- All -->
    <button class="category-btn relative group text-gray-700 font-medium px-5 py-1.5 active-category"
            onclick="filterCategory('All')">
      All
      <span class="absolute left-0 -bottom-1 w-full h-0.5 bg-purple-600 transition-all duration-300"></span>
    </button>

    <!-- Starter -->
    <button class="category-btn relative group text-gray-700 font-medium px-5 py-1.5"
            onclick="filterCategory('Starter')">
      Starter
      <span class="absolute left-0 -bottom-1 w-0 h-0.5 bg-purple-600 transition-all duration-300 group-hover:w-full"></span>
    </button>

    <!-- Main Course -->
    <button class="category-btn relative group text-gray-700 font-medium px-5 py-1.5"
            onclick="filterCategory('Main Course')">
      Main Course
      <span class="absolute left-0 -bottom-1 w-0 h-0.5 bg-purple-600 transition-all duration-300 group-hover:w-full"></span>
    </button>

    <!-- Dessert -->
    <button class="category-btn relative group text-gray-700 font-medium px-5 py-1.5"
            onclick="filterCategory('Dessert')">
      Dessert
      <span class="absolute left-0 -bottom-1 w-0 h-0.5 bg-purple-600 transition-all duration-300 group-hover:w-full"></span>
    </button>

  </nav>
</div>

<script>
// Function to fetch filtered listings and update grid
async function filterCategory(category) {
    try {
        // Fetch filtered listings page from server
        const res = await fetch(`/listings?category=${category}`);
        const htmlText = await res.text();

        // Parse returned HTML and extract the listings grid
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText, 'text/html');
        const newGrid = doc.querySelector('.grid');

        // Replace current listings grid with filtered listings
        const currentGrid = document.querySelector('.grid');
        currentGrid.innerHTML = newGrid.innerHTML;

        // Update active button styles
        document.querySelectorAll('.category-btn').forEach(btn => {
            if (btn.textContent.trim() === category) {
                btn.classList.add('bg-purple-100', 'shadow-lg', 'rounded-lg', 'text-purple-600');
            } else {
                btn.classList.remove('bg-purple-100', 'shadow-lg', 'rounded-lg', 'text-purple-600');
            }
        });
    } catch (err) {
        console.error(err);
    }
}

// Initialize "All" as active on page load
const initial = document.querySelector('.active-category');
initial.classList.add('bg-purple-100', 'shadow-lg', 'rounded-lg', 'text-purple-600');
</script>
